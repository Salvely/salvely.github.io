---
authors:
  - Salvely
title: Arch Linux下的代理配置
tags:
  - Arch
  - Linux
  - 配置
  - 代理
categories:
  - Linux
series:
  - Arch 探索
seriesNavigation: true
enableLastMod: true
enableWordCount: true
enableReadingTime: true
toc:
  enable: true
  auto: false
code:
  maxShownlines: 100
date: 2025-06-17T15:49:24+08:00
lastmod: 2025-06-28T14:08:03+08:00
draft: true
---

<!--more-->

## 环境查看

我们的代理是运行在windows宿主机内的，首先通过`clash`看一下代理所使用的协议和运行的端口号。`General`一栏中`Port`一栏端口号为10808，协议为`http+socks mixed`，也就是`http`和`socks`都支持。`Allow LAN`和`System Proxy`开启。`Start with Windows`是否开机自启动，这个随你便。

WSL2 访问 Windows 代理需使用 **宿主机 IP**。我们要查看一下`IP`地址是什么，方法是`cat /etc/resolv.conf` 查看 `nameserver`(`/etc/resolv.conf`是个重要文件，这里要mark一下，后面学了计算机网络后学习），结果如下：

```bash
[root@DESKTOP-ROOSFVQ ~]# cat /etc/resolv.conf
# This file was automatically generated by WSL. To stop automatic generation of this file, add the following entry to /etc/wsl.conf:
# [network]
# generateResolvConf = false
nameserver 172.17.112.1
```

综上，代理地址为：

```bash
http://172.17.112.1:10808 # HTTP/HTTPS 代理
socks5://172.17.112.1:10808 # SOCKS5 代理
```

如果`clash`代理是运行在`wsl2`内部的，则直接使用：

```bash
http://127.0.0.1:10808 
socks5://127.0.0.1:10808
```

## 终端代理配置

终端代理有两种设置方法，取决于你是想临时设置还是永久设置。如果是临时设置，使用`export`语句即可（`socks5`和`HTTP/HTTPS`协议挑一个就行，这里我选`HTTP/HTTPS`协议）：

```bash
# HTTP/HTTPS 代理
export http_proxy="http://172.17.112.1:10808"
export https_proxy="http://172.17.112.1:10808"

# SOCKS5 代理
# export http_proxy="socks5://172.17.112.1:10808"
# export https_proxy="socks5://172.17.112.1:10808"
```

这里我们想要进行永久设置，方法是把上述配置添加到`~/.bashrc`中去，然后用`source ~/.bashrc`激活。使用`curl google.com`，得到以下结果：

```bash
[root@DESKTOP-ROOSFVQ ~]# curl google.com
<HTML><HEAD><meta http-equiv="content-type" content="text/html;charset=utf-8">
<TITLE>301 Moved</TITLE></HEAD><BODY>
<H1>301 Moved</H1>
The document has moved
<A HREF="http://www.google.com/">here</A>.
</BODY></HTML>
```

则表示使用的是该代理。如果使用的不是该种代理，会出现如下情况：

```bash
[root@DESKTOP-ROOSFVQ ~]# curl google.com
curl: (52) Empty reply from server
```

那么就把它注释掉，换成另一个。

## Git 代理配置

> 以下内容源自deepseek。我使用HTTP协议，代理配置只需要`git config --global http.proxy http://172.17.112.1:10808`这一条语句即可。

Git 代理主要用于 **加速或绕过网络限制**，确保 Git 操作（如克隆、推送、拉取）在复杂网络环境中稳定执行。以下是详细解析，包括代理的作用、协议类型及特性对比：

---

### **一、Git 代理的核心作用**

1. **加速访问**
   - 解决 GitHub/GitLab 等仓库的国内访问慢问题（尤其是 `git clone` 大型仓库时）。
   - 示例：通过代理服务器直连海外节点，避免运营商限速。

2. **绕过网络限制**
   - 突破公司防火墙或地区网络封锁（如某些地区无法访问 GitHub）。

3. **安全访问私有仓库**
   - 通过 SSH 代理或 HTTPS 代理加密传输，防止敏感代码泄露。

---

### **二、Git 支持的协议及其特性**

Git 主要使用 **HTTP/HTTPS** 和 **SSH** 协议与远程仓库交互，不同协议对代理的依赖和配置方式不同。

| **协议**    | **格式示例**                           | **默认端口** | **适用代理类型**        | **核心特性**                                                                  |
| --------- | ---------------------------------- | -------- | ----------------- | ------------------------------------------------------------------------- |
| **HTTP**  | `http://github.com/user/repo.git`  | 80       | HTTP/HTTPS 代理     | - 明文传输（不安全）<br>- 易受防火墙干扰，需频繁输入密码（除非缓存）。                                   |
| **HTTPS** | `https://github.com/user/repo.git` | 443      | HTTP/HTTPS 代理     | - 加密传输（安全）<br>- 需配置凭据缓存（如 `git config --global credential.helper store`）。 |
| **SSH**   | `git@github.com:user/repo.git`     | 22       | SOCKS5 代理或 SSH 隧道 | - 加密传输（安全）<br>- 依赖公钥认证（无需密码）<br>- 更适合高频操作（如开发推送）。                         |

---

### **三、代理协议的类型与特性**

Git 代理通常通过以下协议实现，不同协议适用于不同场景：

| **代理协议**          | **配置示例（Git）**                                                             | **适用场景**          | **特性**                                                       |
| ----------------- | ------------------------------------------------------------------------- | ----------------- | ------------------------------------------------------------ |
| **HTTP/HTTPS 代理** | `git config --global http.proxy http://172.17.112.1:10808`                | 公司内网限制、普通加速       | - 仅支持 HTTP/HTTPS 协议<br>- 配置简单，但无法代理 SSH 流量。                  |
| **SOCKS5 代理**     | `git config --global http.proxy socks5://172.17.112.1:10808`              | 全能代理（支持 HTTP/SSH） | - 支持所有 TCP 流量（包括 SSH）<br>- 需工具如 `nc` 或 SSH 的 `ProxyCommand`。 |
| **SSH 隧道**        | 修改 `~/.ssh/config`：<br>`ProxyCommand nc -X 5 -x 172.17.112.1:10808 %h %p` | 严格防火墙环境（如企业网络）    | - 直接通过 SSH 跳转<br>- 安全性最高，但配置复杂。                              |

---

### **四、如何配置 Git 代理？**

#### **1. HTTP/HTTPS 仓库**

```bash
# 设置代理
git config --global http.proxy http://172.17.112.1:10808
git config --global https.proxy http://172.17.112.1:10808

# 取消代理
git config --global --unset http.proxy
git config --global --unset https.proxy
```

#### **2. SSH 仓库**

修改 `~/.ssh/config`：

```bash
Host github.com
    User git
    ProxyCommand nc -X 5 -x 172.17.112.1:10808 %h %p
```

需安装 `netcat`（Arch Linux: `sudo pacman -S openbsd-netcat`）。

---

### **五、为什么需要多种协议？**

1. **网络环境多样性**
   - 企业网络可能封锁 SSH 端口（22），但开放 HTTPS（443）。
   - 某些地区对 HTTP 协议限速，HTTPS 或 SSH 更稳定。

2. **安全与便捷权衡**
   - **HTTPS**：适合临时使用（如公开仓库克隆），但需管理凭据。
   - **SSH**：适合开发者长期使用（免密码推送），但需配置密钥对。

3. **代理工具限制**
   - 部分代理工具（如 Shadowsocks）默认仅支持 SOCKS5，需转换协议。

---

### **六、常见问题**

#### **1. 如何检查代理是否生效？**

```bash
# 查看 Git 配置
git config --global --get http.proxy

# 测试连接（HTTP/HTTPS）
curl -v https://github.com

# 测试连接（SSH）
ssh -T git@github.com
```

#### **2. 代理冲突怎么办？**

- **现象**：配置代理后无法访问仓库。
- **解决**：

  ```bash
  # 取消全局代理
  git config --global --unset http.proxy

  # 仅对特定域名生效（如 GitHub）
  git config --global http.https://github.com.proxy socks5://172.17.112.1:10808
  ```

#### **3. 克隆速度慢但代理已配置？**

- 可能原因：DNS 污染。
- 解决：强制使用 IPv4：

  ```bash
  git config --global http.https://github.com.proxy http:/172.17.112.1:10808
  git config --global http.postBuffer 524288000  # 增大缓冲区
  ```

---

### **七、总结**

- **Git 代理的作用**：加速访问、绕过限制、提升安全性。
- **协议选择**：
  - **HTTP/HTTPS**：简单易用，适合临时需求。
  - **SSH**：安全高效，适合开发者日常使用。
- **代理协议**：
  - **HTTP/HTTPS 代理**：配置简单，但功能有限。
  - **SOCKS5/SSH 隧道**：全能支持，适合复杂环境。

根据你的网络环境和需求，灵活选择协议和代理方式即可。

## Pacman

要让`Pacman`加速，有2种方法：

- 将`/etc/pacman.d/mirrorlist`中的镜像源换成中国的，这个在前面Arch Linux探索记录那篇文章里面已经写过了，所以这里就不提了；
- 给`pacman`配置代理，这里主要讲这一种；

主要的配置文件是`/etc/pacman.conf`，其中`[options]`部分添加：

```conf
[options]
# HTTP/HTTPS 代理
XferCommand = /usr/bin/curl -x http://172.17.112.1:10808 -L -o %o %u
```

或者直接设置环境变量`/etc/environment`，添加：

```bash
http_proxy="http://172.17.112.1:10808"
https_proxy="http://172.17.112.1:10808"
```

## curl & wget

这里也分两种，1种是临时使用，1种是永久生效。

临时使用：

```bash
curl -x http://172.17.112.1:10808 https://www.google.com
wget -e "http_proxy=http://172.17.112.1:10808" https://www.google.com
```

永久生效：

需要在`~/.curlrc`中写入：

```bash
proxy = "http://172.17.112.1:10808"
```

## Docker

首先，我们需要安装一个Docker。

## 其他代理配置

## 关闭代理

## 总结
